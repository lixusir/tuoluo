(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["mixing"],{"5a8e":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("my-overlay",[n("div",{attrs:{id:"mixing"}}),n("my-prompt",{attrs:{show:t.promptShow},on:{confirm:t.onConfirm}},[n("div",{staticClass:"prize_eggs"},[n("img",{staticClass:"card_prize",attrs:{src:t.$birdList.special[t.mark].normal,alt:"鸟"}}),n("span",[t._v("恭喜获得"+t._s(t.birdName))])])])],1)},i=[],a=(n("d3b7"),n("ac1f"),n("5319"),n("96cf"),n("a4d3"),n("4de4"),n("c740"),n("4160"),n("b680"),n("4fad"),n("e439"),n("dbb4"),n("b64b"),n("159b"),n("2909")),s=n("d4ec"),o=n("bee2"),c=n("ade3"),u=n("9f8e"),h=n("6564"),d=n("4360");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){Object(c["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g=window.innerHeight/window.innerWidth>=1.85,_={jin:"bird_img_jin.png",mu:"bird_img_mu.png",shui:"bird_img_shui.png",huo:"bird_img_huo.png",tu:"bird_img_tu.png",nan:"bird_img_nan.png",nv:"bird_img_nv.png",top:"bird_img_top.png"},f=function(){function t(e){Object(s["a"])(this,t),Object(c["a"])(this,"_scene",null),Object(c["a"])(this,"_layer",null),Object(c["a"])(this,"_canvasWidth",750),Object(c["a"])(this,"_canvasHeight",g?1524:1334),Object(c["a"])(this,"_light",null),Object(c["a"])(this,"_birdsOuterGroup",null),Object(c["a"])(this,"_mixedInfo",null),Object(c["a"])(this,"_resultData",null),Object(c["a"])(this,"_mixing",!1),Object(c["a"])(this,"_hooks",{onClose:null,onFinished:null}),this._mixedInfo=e,this._init()}return Object(o["a"])(t,[{key:"listen",value:function(t){this._hooks=p({},t)}},{key:"_init",value:function(){var t,e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return t=this._canvasWidth,e=this._canvasHeight,this._scene=new u["c"]("#mixing",{viewport:["auto","auto"],resolution:[t,e]}),this._layer=this._scene.layer(),n.next=5,regeneratorRuntime.awrap(this._loading());case 5:this._createStage();case 6:case"end":return n.stop()}}),null,this)}},{key:"_createStage",value:function(){var t=this,e=new u["d"];e.attr({textures:"bg_img_sjhc.png",size:[445,238],pos:[153,242]});var n=new u["d"];n.attr({textures:"bg_img_table.png",size:[this._canvasWidth,645],pos:[0,384]});var r=new u["d"];r.attr({textures:"btn_close.png",size:[70,70],anchor:[.5,.5],pos:[656,279]});var i=this._createBirdsGroup(),a=new u["d"];a.attr({textures:"light_selected.png",size:[200,200],pos:[275,439],opacity:0});var s=new u["d"];s.attr({textures:"icon_pointer.png",size:[90,140],pos:[330,505]});var o=new u["d"];o.attr({anchor:.5,textures:"btn_start.png",size:[130,130],pos:[376,690]}),this._layer.append(e,n,r,i,a,s,o),this._light=a,this._touchAnimated(r,(function(){if(t._mixing)return!1;t._hooks.onClose&&t._hooks.onClose()})),this._touchAnimated(o,(function(){var e,n,r,i;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:if(!t._mixing){a.next=2;break}return a.abrupt("return",!1);case 2:return t._mixing=!0,a.next=5,regeneratorRuntime.awrap(d["a"].dispatch("birdMixing",t._mixedInfo));case 5:e=a.sent,n=e.mark,r=17,t._resultData=e,i=Object.keys(_).findIndex((function(t){return t===n})),r+=i,t._transition(t._birdsOuterGroup,r,0);case 12:case"end":return a.stop()}}))}))}},{key:"_createBirdsGroup",value:function(){var t=560,e=t/2-76,n=[t/2,t/2],r=new u["a"];return r.attr({anchor:.5,size:[t,t],pos:[95+t/2,405+t/2],rotate:180}),Object.entries(_).forEach((function(t,i){var a=n[0]+Math.sin(2*Math.PI/360*(45*i))*e,s=n[1]+Math.cos(2*Math.PI/360*(45*i))*e,o=new u["a"];o.attr({display:"flex",flexWrap:"wrap",flexDirection:"column",alignItems:"center",anchor:.5,size:[141,141],pos:[a,s],rotate:180-45*i});var c=new u["d"];c.attr({textures:t[1],anchor:.5,pos:[75,50],height:90});var h=new u["b"];h.attr({text:d["a"].state.specialBirdNames[t[0]],textAlign:"center",bgcolor:"rgba(255,255,255, 0.5)",font:"small-caps bold 21px Arial",color:"#6C2127",padding:[10,15,5,15],borderRadius:20}),o.append(c,h),r.append(o)})),this._birdsOuterGroup=r,r}},{key:"_transition",value:function(t,e,n){return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,regeneratorRuntime.awrap(t.transition(.15).attr({rotate:45*n+180}));case 3:e--,n++,e>0?this._transition(t,e,n):(console.log("over"),this._light.transition(.2).attr({opacity:1}),this._hooks.onFinished&&this._hooks.onFinished(this._resultData),this._mixing=!1),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](0),console.warn(r.t0);case 11:case"end":return r.stop()}}),null,this,[[0,8]])}},{key:"_loading",value:function(){var t;return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return this._scene.on("preload",(function(t){console.log("加载中... ".concat(100*(t.loaded.length/t.resources.length).toFixed(2),"%"))})),e.next=3,regeneratorRuntime.awrap((t=this._scene).preload.apply(t,Object(a["a"])(h["a"].mixing)));case 3:case"end":return e.stop()}}),null,this)}},{key:"_touchAnimated",value:function(t,e){t.on("touchstart",(function(e){e.stopDispatch(),t.attr({scale:.95})})),t.on("touchend",(function(n){n.stopDispatch(),t.attr({scale:1}),e&&e()}))}}]),t}(),b=f,m=n("13f3"),v={name:"mixing",data:function(){return{promptShow:!1,mark:"jin",birdName:""}},mounted:function(){this.getData()},methods:{getData:function(){var t,e,n,r,i,a,s=this;return regeneratorRuntime.async((function(o){while(1)switch(o.prev=o.next){case 0:t=this.$route.query,e=t.did,n=t.cid,r=t.dindex,i=t.cindex,a=new b({drapedId:e,collisionedId:n,drapedIndex:r,collisionedIndex:i}),a.listen({onClose:function(){s.$router.back(-1)},onFinished:function(t){var e=t.levelName,n=t.mark;s.mark=n,s.birdName=e,m["a"].updateBirdView(),s.promptShow=!0,s.$store.dispatch("getPictorialBook")}});case 3:case"end":return o.stop()}}),null,this)},onConfirm:function(){this.promptShow=!1,this.$router.replace({path:"/"})}}},w=v,x=(n("7ef8"),n("2877")),y=Object(x["a"])(w,r,i,!1,null,"c3f389b8",null);e["default"]=y.exports},"7ef8":function(t,e,n){"use strict";var r=n("d83e"),i=n.n(r);i.a},c740:function(t,e,n){"use strict";var r=n("23e7"),i=n("b727").findIndex,a=n("44d2"),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),r({target:"Array",proto:!0,forced:o},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),a(s)},d83e:function(t,e,n){}}]);